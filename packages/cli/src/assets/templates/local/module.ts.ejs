<%# Template generated from a single entrypoint
    input: 
      - source : the main export of the package
      - config: the full entrypoint object 
%>
import { AddressInfo } from "node:net";
import querystring from "node:querystring"; 
import jwt from "jsonwebtoken";

import { RouterInstance, localCloudProvider } from '@cloudnux/local-cloud-provider';

import {
  httpHandler,
  eventBrokerHandler,
  scheduleHandler,
  useCloudProvider,
} from "@cloudnux/cloud-sdk";

import * as src from "<%= source %>";

useCloudProvider(localCloudProvider);

async function entries(app: RouterInstance) {
  <%_ for (const [name, entry] of Object.entries(entries)) { _%>
    <%_ if (entry.trigger.type === "http") { _%>
      <%- include("triggers/http.ts.ejs", {
        name,
        entry
      }) %>
    <%_ } _%>
    <%_ if (entry.trigger.type === "schedule") { _%>
      <%- include("triggers/schedule.ts.ejs", {
        name,
        entry
      }) %>
    <%_ } _%>
    <%_ if(entry.trigger.type === "event") { _%>
      app.queues.addQueue("<%=entry.trigger.options.source%>", src["<%= entry.handler %>"]);
    <%_ } _%>
  <%_ } _%>
}

export default entries;